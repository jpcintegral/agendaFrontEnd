 <!--<mat-form-field appearance="outline" class="date-filter">
  <mat-label>Filtrar por día</mat-label>
  <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" (dateChange)="onDateChange()" />
  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
  <mat-datepicker #picker></mat-datepicker>
</mat-form-field>-->

<!-- Calendario tipo Google -->
<app-calendar
  [events]="getCalendarEvents()" 
  [selectedDate]="selectedDate"
  [userRole]="userRole"
  [userArreas]="userArreas"
  (daySelected)="applyFilter($event)">  
</app-calendar>
<div class="event-list-header">
  <mat-tab-group class="custom-tab-group" (selectedIndexChange)="onTabChange($event)">
     <mat-tab label="Aprobados ({{ countByStatus('aprobado') }})" (click)="selectedStatus='aprobado'; applyFilter()"></mat-tab>
     <mat-tab label="Pendientes ({{ countByStatus('pendiente') }})" (click)="selectedStatus='pendiente'; applyFilter()"></mat-tab>
     <mat-tab label="Considerados ({{ countByStatus('considerando') }})" (click)="selectedStatus='considerando'; applyFilter()"></mat-tab>
     <mat-tab label="Todos ({{ countByStatus('todos') }})" (click)="selectedStatus='todos'; applyFilter()"></mat-tab>   
     <mat-tab label="Cancelados ({{ countByStatus('cancelado') }})" (click)="selectedStatus='cancelado'; applyFilter()"></mat-tab>
  </mat-tab-group>
<div class="event-grid">
  <mat-card *ngFor="let event of filteredEvents" class="event-card" [ngClass]="getStatusClass(event.status)">
    
    <div class="order-badge">{{ event.order }}</div>

    <!-- Tarjeta especial para eventos privados -->
    <ng-container *ngIf="event.type === 'privado' && userRole !== 'Presidente'; else normalCard">
      <mat-card-header>
        <mat-card-title>Evento Privado 🔒</mat-card-title>
        <mat-card-subtitle>
          <span class="status-badge">{{ event.status | uppercase }}</span>
        </mat-card-subtitle>
      </mat-card-header>
      <hr class="divider" />
      <mat-card-content class="card-content-wrapper private-card">
        <p>Este evento es privado.</p>
        <p>
          <strong>Inicio:</strong> {{ event.startDateTime | date:'dd/MM/yyyy HH:mm' }} 
          <mat-icon class="inline-icon">calendar_today</mat-icon>
        </p>
        <p>
          <strong>Fin:</strong> {{ event.endDateTime | date:'dd/MM/yyyy HH:mm' }} 
          <mat-icon class="inline-icon">calendar_today</mat-icon>
        </p>
      </mat-card-content>
    </ng-container>

    <!-- Tarjeta normal -->
    <ng-template #normalCard>
      <mat-card-header>
        <mat-card-title>{{ event.title }}</mat-card-title>
        <mat-card-subtitle>
          <span class="status-badge">{{ event.status | uppercase }}</span>
        </mat-card-subtitle>
      </mat-card-header>
      <hr class="divider" />
      <mat-card-content class="card-content-wrapper">
        <span *ngIf="event.needsBudget || event.estimatedBudget" class="budget-badge">
          <ng-container *ngIf="event.needsBudget">Requiere Presupuesto</ng-container>
          <ng-container *ngIf="event.needsBudget && event.estimatedBudget"> | </ng-container>
          <ng-container *ngIf="event.estimatedBudget">
            Estimado: {{ event.estimatedBudget | currency:'MXN':'symbol':'1.0-0' }}
          </ng-container>
        </span>
        <p class="description">{{ event.description }}</p>
        <p>
          <strong>Inicio:</strong> {{ event.startDateTime | date:'dd/MM/yyyy HH:mm' }} 
          <mat-icon class="inline-icon">calendar_today</mat-icon>
        </p>
        <p>
          <strong>Fin:</strong> {{ event.endDateTime | date:'dd/MM/yyyy HH:mm' }} 
          <mat-icon class="inline-icon">calendar_today</mat-icon>
        </p>
        <p>
          <strong>Duración:</strong> {{ event.durationHours }} hrs
          <mat-icon class="inline-icon">schedule</mat-icon>
        </p>
      </mat-card-content>

      <!-- Acciones -->
      <mat-card-actions class="card-actions" *ngIf="userRole === 'Presidente' || isUserAssigned(event)">
        <mat-form-field appearance="fill" style="width: 100%;">
          <mat-label>Acción</mat-label>
          <mat-select (selectionChange)="onStatusChange(event, $event)" >
            
            <!-- Opción Ver -->
            <mat-option *ngIf=" isUserAssigned(event)" [value]="'ver'">
              <mat-icon>visibility</mat-icon> Ver
            </mat-option>

            <!-- Opción Aprobar -->
            <mat-option *ngIf="userRole === 'Presidente' && (event.status === 'pendiente' || event.status === 'considerando')" [value]="'aprobar'">
              <mat-icon>check_circle</mat-icon> Aprobar
            </mat-option>

            <!-- Opción Considerando -->
            <mat-option *ngIf="userRole === 'Presidente' && (event.status === 'pendiente' || event.status === 'considerando')" [value]="'considerando'">
              <mat-icon>check_circle</mat-icon> Considerando
            </mat-option>

            <!-- Opción Cancelar -->
            <mat-option *ngIf="(userRole === 'Presidente' || userRole === 'Secretaria') && (event.status !== 'pendiente' && event.status !== 'cancelado')" [value]="'cancelar'">
              <mat-icon>cancel</mat-icon> Cancelar
            </mat-option>

            <!-- Opción Eliminar -->
            <mat-option *ngIf="event.status === 'pendiente' || event.status === 'cancelado'" [value]="'eliminar'">
              <mat-icon>delete</mat-icon> Eliminar
            </mat-option>
            
          </mat-select>
        </mat-form-field>
      </mat-card-actions>
    </ng-template>
  </mat-card>
</div>
